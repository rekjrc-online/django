{% extends "base.html" %}
{% block content %}

<!-- Profile summary -->
{% include "profiles/profile_header.html" %}

<div class="post card">
    <h2>
        Race Details
        {% if race.human == request.user %}
            <font size="-1">(<a href="{% url 'races:race_update' profile.id %}" class="btn btn-sm btn-primary">Update Race</a>)</font>
        {% endif %}
    </h2>
    <p><strong>Race Type:</strong> {{ race.race_type|default:"" }}</p>
    {% if race.event %}
        <p><strong>Event:</strong> {{ race.event }}</p>
    {% endif %}
    {% if race.location %}
        <p><strong>Location:</strong> {{ race.location }}</p>
    {% endif %}
    {% if race.club %}
        <p><strong>Club:</strong> {{ race.club }}</p>
    {% endif %}
    {% if race.team %}
        <p><strong>Team:</strong> {{ race.team }}</p>
    {% endif %}
    {% if not user_is_in_race %}
        <br />
        <div>
            <a href="{% url 'races:race_join' race.profile.id %}"
           >
            Join Race
            </a>
        </div>
        <br />
    {% else %}
        <b>Entry:</b> You are entered in this race<br />
    {% endif %}
    <br />
</div>

{% if attributes.exists %}
    <div class="post card">
        <h3>Attributes</h3>
        <table>
            {% for attr in attributes.all %}
                <tr>
                    <td>{{ attr.attribute.name }}</td>
                    <td>{{ attr.value }}</td>
                </tr>
            {% endfor %}
        </table>
    </div>
{% endif %}

<!-- ðŸ Race Entries Section -->
<div class="post card">
    <h3>Race Entries</h3>
    {% if race.race_drivers.exists %}
        <table>
            <thead>
                <tr>
                    <th>Human</th>
                    <th>Driver</th>
                    <th>Model</th>
                </tr>
            </thead>
            <tbody>
                {% for rd in race.race_drivers.all %}
                <tr>
                    <td>
                        {% if rd.human %}
                            {{ rd.human.username }}
                        {% else %}
                            -none-
                        {% endif %}
                    </td>
                    <td>
                        {% if rd.driver %}
                            {% if rd.driver.avatar %}
                                <img src="{{ rd.driver.avatar.url }}">
                            {% endif %}
                            {{ rd.driver.displayname }}
                        {% else %}
                            -none-
                        {% endif %}
                    </td>
                    <td>
                        {% if rd.model %}
                            {% if rd.model.avatar %}
                                <img src="{{ rd.model.avatar.url }}">
                            {% endif %}
                            {{ rd.model.displayname }}
                        {% else %}
                            <em>-</em>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No drivers have joined this race yet.</p>
    {% endif %}
    <br />
</div>

<br />

<div>
    <a href="{% url 'races:race_list' %}">Back To Race List</a>
</div>

<br /><br /><br />

{% endblock %}
