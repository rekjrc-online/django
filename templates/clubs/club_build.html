{% extends "base.html" %}

{% block content %}
<h3>{% if club %}Edit Club{% else %}Create New Club{% endif %}</h3>

{% if not user.is_verified %}

  <p class="text-danger">
      Your account is not verified. You must verify your account before you can create or edit a club.
  </p>
  <a href="/humans/update/">Verify your account</a>

{% elif user.profile_set.exists %}
    <div class="post card" style="margin-top: 20px; padding: 10px;">
        <!-- Club Profile Info -->
        <table>
            <tr>
                <td valign="top" align="center">
                    {% if club.profile.avatar %}
                        <a target="_blank" href="{{ club.profile.avatar.url }}">
                            <img src="{{ club.profile.avatar.url }}" alt="Avatar" class="avatar">
                        </a>
                    {% else %}
                        <img src="/static/nophoto_{{ club.profile.profiletype }}.png" alt="Avatar" class="avatar">
                    {% endif %}
                </td>
                <td style="width: 10px;"></td>
                <td valign="top">
                    <h2>{{ club.profile.displayname }}</h2>
                </td>
            </tr>
        </table>

        <!-- Club Form -->
        <form method="post" enctype="multipart/form-data" style="width: 100%; margin-top: 15px;">
            {% csrf_token %}
            {{ form.non_field_errors }}
            {{ form.profile }}

            <div style="margin-bottom: 10px;">
                {{ form.name.label_tag }}<br>
                {{ form.name }}
                {{ form.name.errors }}
            </div>

            <div style="margin-bottom: 10px;">
                {{ form.description.label_tag }}<br>
                {{ form.description }}
                {{ form.description.errors }}
            </div>

            <div class="post card" style="margin-top: 20px; padding: 10px;">
              <!-- Members Formset -->
              {% if member_formset %}
                  {{ member_formset.management_form }}
                  <h4>Members</h4>
                  <table style="width:100%; border-collapse: collapse; margin-bottom: 15px;">
                      <thead>
                          <tr>
                              <th style="text-align:left; padding:5px;">Member</th>
                              <th style="text-align:left; padding:5px;">Role / Info</th>
                              <th style="padding:5px;">Delete</th>
                          </tr>
                      </thead>
                      <tbody>
                          {% for form in member_formset.forms %}
                              {{ form.id }}
                              <tr>
                                  <td style="padding:5px;">{{ form.human }}</td>
                                  <td style="padding:5px;">{{ form.role }}</td>
                                  <td style="text-align:center; padding:5px;">
                                      {% if form.instance.pk %}
                                          {{ form.DELETE }}
                                      {% endif %}
                                  </td>
                              </tr>
                          {% endfor %}
                          <tr class="empty-form" style="display:none;">
                              <td style="padding:5px;">{{ member_formset.empty_form.human }}</td>
                              <td style="padding:5px;">{{ member_formset.empty_form.role }}</td>
                              <td style="text-align:center; padding:5px;">
                                  <button type="button" id="add-member" style="padding:2px; background-color:#1da1f2; color:white; border:none; border-radius:5px; cursor:pointer; width:30px;">
                                      +
                                  </button>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              {% endif %}
            </div>

            <div class="post card" style="margin-top: 20px; padding: 10px;">
              <!-- Locations Formset -->
              {% if location_formset %}
                  {{ location_formset.management_form }}
                  <h4>Locations</h4>
                  <table style="width:100%; border-collapse: collapse; margin-bottom: 15px;">
                      <thead>
                          <tr>
                              <th style="text-align:left; padding:5px;">Name</th>
                              <th style="text-align:left; padding:5px;">Address</th>
                              <th style="padding:5px;">Delete</th>
                          </tr>
                      </thead>
                      <tbody>
                          {% for form in location_formset.forms %}
                              {{ form.id }}
                              <tr>
                                  <td style="padding:5px;">{{ form.name }}</td>
                                  <td style="padding:5px;">{{ form.address }}</td>
                                  <td style="text-align:center; padding:5px;">
                                      {% if form.instance.pk %}
                                          {{ form.DELETE }}
                                      {% endif %}
                                  </td>
                              </tr>
                          {% endfor %}
                          <tr class="empty-form" style="display:none;">
                              <td style="padding:5px;">{{ location_formset.empty_form.name }}</td>
                              <td style="padding:5px;">{{ location_formset.empty_form.address }}</td>
                              <td style="text-align:center; padding:5px;">
                                  <button type="button" id="add-location" style="padding:2px; background-color:#1da1f2; color:white; border:none; border-radius:5px; cursor:pointer; width:30px;">
                                      +
                                  </button>
                              </td>
                          </tr>
                      </tbody>
                  </table>
              {% endif %}
            </div>

            <button type="submit" style="padding:10px 20px; background-color:#1da1f2; color:white; border:none; border-radius:5px; cursor:pointer;">
                {% if club %}Update Club{% else %}Create Club{% endif %}
            </button>
        </form>
    </div>

{% else %}
    <p>
        You must create a profile before you can create a club.
        <br /><br />
        <a href="/profiles/">Create a profile</a>
    </p>
{% endif %}
{% endblock %}
