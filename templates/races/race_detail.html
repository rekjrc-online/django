{% extends "base.html" %}
{% block content %}

<!-- Profile summary -->
{% include "profiles/profile_header.html" %}

<div class="post card" style="padding:0px 20px; margin:0px;">
    <h2>
        Race Details
        {% if race.human == request.user %}
            <font size="-1">(<a href="{% url 'races:race_update' profile.id %}" class="btn btn-sm btn-primary">Update Race</a>)</font>
        {% endif %}
    </h2>
    <p><strong>Race Type:</strong> {{ race.race_type|default:"" }}</p>
    {% if race.event %}
        <p><strong>Event:</strong> {{ race.event }}</p>
    {% endif %}
    {% if race.location %}
        <p><strong>Location:</strong> {{ race.location }}</p>
    {% endif %}
    {% if race.club %}
        <p><strong>Club:</strong> {{ race.club }}</p>
    {% endif %}
    {% if race.team %}
        <p><strong>Team:</strong> {{ race.team }}</p>
    {% endif %}
    {% if not user_is_in_race %}
        <br />
        <div style="text-align:center; margin-top:20px;">
            <a href="{% url 'races:race_join' race.profile.id %}"
            style="padding:8px 20px; background-color:#1da1f2; color:white; border:none; border-radius:5px; text-decoration:none;">
            Join Race
            </a>
        </div>
        <br />
    {% else %}
        <b>Entry:</b> You are entered in this race<br />
    {% endif %}
    <br />
</div>

{% if attributes.exists %}
    <div class="post card" style="padding:0px 20px 20px 20px; margin-top:3px;">
        <h3>Attributes</h3>
        <table style="width:100%; border-collapse:collapse;">
            {% for attr in attributes.all %}
                {% if attr.value %}
                    <tr>
                        <td style="padding:5px;">{{ attr.attribute.name }}</td>
                        <td style="padding:5px;">{{ attr.value }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
        </table>
    </div>
{% endif %}

<!-- ðŸ Race Entries Section -->
<div class="post card" style="padding:20px; margin-top:5px;">
    <h3>Race Entries</h3>

    {% if race.race_drivers.exists %}
        <table style="width:100%; border-collapse:collapse;">
            <thead>
                <tr style="border-bottom:1px solid #ddd;">
                    <th style="text-align:left; padding:5px;">Human</th>
                    <th style="text-align:left; padding:5px;">Driver</th>
                    <th style="text-align:left; padding:5px;">Model</th>
                </tr>
            </thead>
            <tbody>
                {% for rd in race.race_drivers.all %}
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:5px;">
                        {% if rd.human %}
                            {{ rd.human.username }}
                        {% else %}
                            -none-
                        {% endif %}
                    </td>
                    <td style="padding:5px;">
                        {% if rd.driver %}
                            {% if rd.driver.avatar %}
                                <img src="{{ rd.driver.avatar.url }}" style="height:30px; width:30px; border-radius:50%; vertical-align:middle;">
                            {% endif %}
                            {{ rd.driver.displayname }}
                        {% else %}
                            -none-
                        {% endif %}
                    </td>
                    <td style="padding:5px;">
                        {% if rd.model %}
                            {% if rd.model.avatar %}
                                <img src="{{ rd.model.avatar.url }}" style="height:30px; width:30px; border-radius:50%; vertical-align:middle;">
                            {% endif %}
                            {{ rd.model.displayname }}
                        {% else %}
                            <em>-</em>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No drivers have joined this race yet.</p>
    {% endif %}
</div>

<div style="text-align:center; margin-top:10px;">
    <a href="{% url 'races:race_list' %}">Back To Race List</a>
</div>

<br /><br /><br />

{% endblock %}
