{% extends "base.html" %}

{% block content %}
<h3>Your Races</h3>

{% if races %}
    {% for race in races %}
        <div class="post card" style="margin-bottom: 20px;">
            <table>
                <tr>
                    <td valign="top" align="center" nowrap>
                        {% if race.profile.avatar %}
                            <a target="_blank" href="{{ race.profile.avatar.url }}">
                                <img src="{{ race.profile.avatar.url }}" alt="Avatar" class="avatar">
                            </a>
                        {% else %}
                            <img src="/static/nophoto_{{ race.profile.profiletype }}.png" alt="Avatar" class="avatar">
                        {% endif %}

                        <p>{{ race.profile.get_profiletype_display }}</p>
                        <p>
                            <a href="{% url 'races:race_update' race.profile.id %}">Edit</a> /
                            <a href="{% url 'races:race_detail' race.profile.id %}">View</a> /
                            <a href="{% url 'races:race_delete' race.profile.id %}">Delete</a>
                        </p>
                    </td>
                    <td style="width: 15px;"></td>
                    <td valign="top">
                        <b>{{ race.profile.displayname }}</b>
                        <p>
                            <strong>Race Type:</strong> {{ race.race_type }}<br>
                            {% if race.event %}<strong>Event:</strong> {{ race.event }}<br>{% endif %}
                            {% if race.location %}<strong>Location:</strong> {{ race.location }}<br>{% endif %}
                            {% if race.club %}<strong>Club:</strong> {{ race.club }}<br>{% endif %}
                            {% if race.team %}<strong>Team:</strong> {{ race.team }}<br>{% endif %}
                        </p>

                        {% if race.attributes.exists %}
                            <table style="border-collapse:collapse; width:100%; font-size:0.9em;">
                                {% for attr in race.attributes.all %}
                                    <tr>
                                        <td style="padding:3px 5px; border-bottom:1px solid #ddd;">
                                            {{ attr.attribute.name }}
                                        </td>
                                        <td style="padding:3px 5px; border-bottom:1px solid #ddd;">
                                            {{ attr.value }}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </table>
                        {% else %}
                            <p style="color:gray; font-size:0.9em;">No attributes yet.</p>
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>
    {% endfor %}
{% else %}
    <p>You haven’t added any races yet.</p>
{% endif %}

<div class="post card" style="margin-top:20px;">
    <h3>Create New Race</h3>
    <form method="get" action="">
        {% comment %}
        Typically, the user would choose which profile this race belongs to.
        Replace this with your actual profile selection logic.
        {% endcomment %}
        <p>Select a profile to create a race for:</p>
        <ul style="list-style-type:none; padding:0;">
            {% for profile in profiles %}
                <li>
                    <a href="{% url 'races:race_create' profile.id %}" style="text-decoration:none;">
                        ➕ {{ profile.displayname }}
                    </a>
                </li>
            {% endfor %}
        </ul>
    </form>
</div>
{% endblock %}
